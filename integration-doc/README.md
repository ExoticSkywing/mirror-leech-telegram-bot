# Parse-Video + Mirror-Leech-Telegram-Bot é›†æˆé¡¹ç›®

## ğŸ“– é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®å°† **Parse-Video**ï¼ˆGoè¯­è¨€è§†é¢‘è§£ææœåŠ¡ï¼‰é›†æˆåˆ° **Mirror-Leech-Telegram-Bot**ï¼ˆPython Telegramæœºå™¨äººï¼‰ä¸­ï¼Œå®ç°ï¼š

âœ¨ **æ ¸å¿ƒåŠŸèƒ½**
- ğŸ¬ ç›´æ¥å‘é€è§†é¢‘é“¾æ¥ï¼Œæ— éœ€å‘½ä»¤
- ğŸš€ æ™ºèƒ½è§£æï¼šParse-Video â†’ yt-dlp åŒé‡ä¿éšœ
- ğŸ’§ æ— æ°´å°ä¸‹è½½ï¼šParse-Videoæä¾›å»æ°´å°ç›´é“¾
- ğŸ“¸ å›¾é›†æ”¯æŒï¼šè‡ªåŠ¨è¯†åˆ«å¹¶ä»¥ç›¸å†Œå½¢å¼ä¸Šä¼ 
- ğŸ” æƒé™æ§åˆ¶ï¼šä»…æˆæƒç”¨æˆ·å¯ä½¿ç”¨
- âš¡ é«˜æ€§èƒ½ï¼š8-10ç§’å®Œæˆä»é“¾æ¥åˆ°è§†é¢‘

ğŸ¯ **æ”¯æŒå¹³å°**
- å¿«æ‰‹ âœ…ï¼ˆå·²æµ‹è¯•ï¼‰
- æŠ–éŸ³ï¼ˆç†è®ºæ”¯æŒï¼‰
- å°çº¢ä¹¦ï¼ˆç†è®ºæ”¯æŒï¼‰
- Bç«™ï¼ˆç†è®ºæ”¯æŒï¼‰
- TikTokï¼ˆç†è®ºæ”¯æŒï¼‰
- YouTubeï¼ˆyt-dlpå…œåº•ï¼‰
- æ›´å¤šå¹³å°...

---

## ğŸ“š æ–‡æ¡£å¯¼èˆª

### ğŸš€ å¿«é€Ÿå¼€å§‹
- **[å¿«é€Ÿå‚è€ƒå¡ç‰‡](QUICK_REFERENCE.md)** - 5åˆ†é’Ÿé€ŸæŸ¥ï¼Œä¸€é”®éƒ¨ç½²
- **[é›†æˆéƒ¨ç½²æŒ‡å—](INTEGRATION_GUIDE.md)** - è¯¦ç»†çš„åˆ†æ­¥éƒ¨ç½²æ•™ç¨‹

### ğŸ“‹ æŠ€æœ¯æ–‡æ¡£
- **[åŠŸèƒ½æ€»ç»“](PARSE_VIDEO_INTEGRATION_SUMMARY.md)** - å®Œæ•´çš„æŠ€æœ¯å®ç°ç»†èŠ‚
- **[æµ‹è¯•æ¸…å•](TEST_CHECKLIST.md)** - ç³»ç»ŸåŒ–çš„æµ‹è¯•æ–¹æ¡ˆ

### ğŸ› é—®é¢˜è§£å†³
- **[æ•…éšœæ’é™¤æŒ‡å—](TROUBLESHOOTING.md)** - å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆï¼ˆå¿…è¯»ï¼ï¼‰

### ğŸ§ª æµ‹è¯•è„šæœ¬
- `test_parse_video_api.py` - Parse-Video APIç›´æ¥æµ‹è¯•
- `test_parse_video_helper.py` - Pythonæ¨¡å—å•å…ƒæµ‹è¯•
- `test_video_parser_logic.py` - æ ¸å¿ƒé€»è¾‘æµ‹è¯•

---

## ğŸ¯ é¡¹ç›®çŠ¶æ€

### âœ… å·²å®Œæˆï¼ˆ100%ï¼‰

**é˜¶æ®µ1: ç¯å¢ƒå‡†å¤‡**
- âœ… Parse-Video Dockeréƒ¨ç½²
- âœ… Botç¯å¢ƒåˆ†æ
- âœ… ä¾èµ–å®‰è£…ï¼ˆaiohttpï¼‰

**é˜¶æ®µ2: æ ¸å¿ƒæ¨¡å—å¼€å‘**
- âœ… `parse_video_helper.py` - APIè°ƒç”¨å°è£…
- âœ… `url_utils.py` - URLæ£€æµ‹å·¥å…·
- âœ… `video_parser.py` - è§†é¢‘å¤„ç†æ ¸å¿ƒï¼ˆ405è¡Œï¼‰
- âœ… `direct_link_handler.py` - æ¶ˆæ¯æ‹¦æˆªå™¨

**é˜¶æ®µ3: Boté›†æˆ**
- âœ… `handlers.py` ä¿®æ”¹ - æ·»åŠ ç›´æ¥æ¶ˆæ¯å¤„ç†
- âœ… `config.py` é…ç½® - Parse-Videoè®¾ç½®
- âœ… Dockeré•œåƒæ„å»º

**é˜¶æ®µ4: æµ‹è¯•éªŒè¯**
- âœ… å•å…ƒæµ‹è¯•
- âœ… é›†æˆæµ‹è¯•
- âœ… å®é™…éƒ¨ç½²æµ‹è¯•
- âœ… å¿«æ‰‹è§†é¢‘ä¸‹è½½éªŒè¯

**é˜¶æ®µ5: é—®é¢˜ä¿®å¤**
- âœ… TaskListenerå±æ€§åˆå§‹åŒ–é—®é¢˜
- âœ… URLä¼ é€’æ—¶æœºé—®é¢˜
- âœ… Dockerç¼“å­˜é—®é¢˜
- âœ… on_download_completeå›è°ƒé—®é¢˜

**é˜¶æ®µ6: æ–‡æ¡£å®Œå–„**
- âœ… éƒ¨ç½²æŒ‡å—
- âœ… æ•…éšœæ’é™¤
- âœ… å¿«é€Ÿå‚è€ƒ
- âœ… APIæ–‡æ¡£

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```
ç”¨æˆ·å‘é€è§†é¢‘é“¾æ¥
    â†“
direct_link_handler (æ¶ˆæ¯æ‹¦æˆª)
    â†“ æƒé™æ£€æŸ¥
VideoLinkProcessor (æ ¸å¿ƒå¤„ç†)
    â†“
parse_video_helper (APIè°ƒç”¨)
    â†“
Parse-Video Service (GoæœåŠ¡)
    â†“ è¿”å›ç›´é“¾
yt-dlp (ä¸‹è½½è§†é¢‘)
    â†“
TelegramUploader (ä¸Šä¼ )
    â†“
ç”¨æˆ·æ”¶åˆ°è§†é¢‘
```

### å®¹å™¨æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Docker: mirror-leech-telegram-bot  â”‚
â”‚  - Python Bot                       â”‚
â”‚  - yt-dlp                           â”‚
â”‚  - æ–°å¢æ¨¡å—                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ HTTP
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Docker: parse-video                â”‚
â”‚  - Go Service                       â”‚
â”‚  - Port: 18085                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¡ åˆ›æ–°ç‚¹

1. **å¾®æœåŠ¡æ¶æ„** - Goå’ŒPythonæœåŠ¡è§£è€¦ï¼Œç‹¬ç«‹æ‰©å±•
2. **æ™ºèƒ½é™çº§ç­–ç•¥** - Parse-Videoå¤±è´¥æ—¶è‡ªåŠ¨åˆ‡æ¢yt-dlp
3. **é›¶å­¦ä¹ æˆæœ¬** - ç›´æ¥å‘é“¾æ¥ï¼Œæ— éœ€è®°å¿†å‘½ä»¤
4. **å®Œç¾å…¼å®¹** - ä¸å½±å“Botä»»ä½•ç°æœ‰åŠŸèƒ½
5. **å›¾é›†ç›¸å†Œ** - TelegramåŸç”Ÿåª’ä½“ç»„æ”¯æŒ
6. **æ— æ°´å°ä¿è¯** - Parse-Videoæä¾›åŸå§‹é«˜æ¸…ç›´é“¾

---

## ğŸ”‘ å…³é”®æŠ€æœ¯éš¾ç‚¹è§£å†³

### 1. TaskListenerç»§æ‰¿é—®é¢˜
**æŒ‘æˆ˜:** `VideoLinkProcessor`ç»§æ‰¿`TaskListener`æ—¶ï¼Œå¤šä¸ªå…³é”®å±æ€§æœªæ­£ç¡®åˆå§‹åŒ–

**è§£å†³æ–¹æ¡ˆ:**
- `self.thumb = "none"` - å¿…é¡»æ˜¯å­—ç¬¦ä¸²ï¼Œä¸èƒ½æ˜¯None
- `self.same_dir = None` - é˜²æ­¢AttributeError
- `self.link` - åœ¨before_start()å‰è®¾ç½®

### 2. å¼‚æ­¥å›è°ƒé—®é¢˜
**æŒ‘æˆ˜:** `on_download_complete()`ä¸­æ–­ï¼Œå¯¼è‡´ä¸Šä¼ å¤±è´¥

**è§£å†³æ–¹æ¡ˆ:**
- æ·»åŠ è¯¦ç»†æ—¥å¿—è¿½è¸ª
- è¦†ç›–æ–¹æ³•å¹¶æ•è·æ‰€æœ‰å¼‚å¸¸
- ç¡®ä¿æ‰€æœ‰å±æ€§åœ¨å›è°ƒå‰åˆå§‹åŒ–

### 3. Dockeræ„å»ºç¼“å­˜
**æŒ‘æˆ˜:** ä»£ç æ›´æ–°åå®¹å™¨ä»è¿è¡Œæ—§ç‰ˆæœ¬

**è§£å†³æ–¹æ¡ˆ:**
- ä½¿ç”¨`--no-cache`å¼ºåˆ¶å®Œå…¨é‡å»º
- éªŒè¯æ–‡ä»¶ç¡®å®åœ¨å®¹å™¨ä¸­

### 4. URLä¼ é€’æ—¶æœº
**æŒ‘æˆ˜:** yt-dlpæ— æ³•è·å–æ­£ç¡®çš„è§†é¢‘URL

**è§£å†³æ–¹æ¡ˆ:**
- åœ¨`_download_with_ytdlp()`å¼€å§‹æ—¶ç«‹å³è®¾ç½®`self.link = url`
- ç¡®ä¿åœ¨`before_start()`è°ƒç”¨ä¹‹å‰

---

## ğŸ“Š æ€§èƒ½æ•°æ®

### æµ‹è¯•æ¡ˆä¾‹ï¼šå¿«æ‰‹è§†é¢‘
- **URL:** `https://v.kuaishou.com/KNXxJe25`
- **æ ‡é¢˜:** "å¥³æœ‹å‹è‡ªå·±ä¸€ä¸ªäººåœ¨å®¶éƒ½å¹²ç‚¹å•¥"
- **å¤§å°:** 624.32KB
- **Parse-Videoå“åº”:** ~3-4ç§’
- **ä¸‹è½½é€Ÿåº¦:** 2.5MB/s
- **æ€»è€—æ—¶:** ~8-10ç§’ï¼ˆä»å‘é€åˆ°æ”¶åˆ°ï¼‰
- **ç»“æœ:** âœ… æˆåŠŸï¼Œæ— æ°´å°

### èµ„æºå ç”¨
- **Parse-Videoå®¹å™¨:** ~50MBå†…å­˜
- **Botå®¹å™¨å¢é‡:** å¿½ç•¥ä¸è®¡ï¼ˆçº¯Pythonæ¨¡å—ï¼‰
- **ç£ç›˜ç©ºé—´:** +100KBï¼ˆæ–°å¢ä»£ç ï¼‰

---

## ğŸš€ å¿«é€Ÿéƒ¨ç½²ï¼ˆ5åˆ†é’Ÿï¼‰

```bash
# 1. å…‹éš†æˆ–ä¸‹è½½ä»£ç 
cd /root/data

# 2. å¯åŠ¨Parse-Video
docker run -d --name parse-video --restart unless-stopped \
  -p 18085:8080 wujunwei928/parse-video

# 3. é…ç½®Bot
cd /root/data/docker_data/mirror-leech-telegram-bot
cat >> config.py << 'EOF'

# Parse-Video Service Configuration
PARSE_VIDEO_API = "http://localhost:18085"
PARSE_VIDEO_ENABLED = True
PARSE_VIDEO_TIMEOUT = 30
EOF

# 4. å¤åˆ¶æ–°æ–‡ä»¶ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
# æ–‡ä»¶å·²åœ¨ /root/data/docker_data/mirror-leech-telegram-bot/ ä¸­

# 5. é‡å¯Bot
docker-compose down
docker-compose build --no-cache
docker-compose up -d

# 6. éªŒè¯
docker logs -f mirror-leech-telegram-bot-app-1
```

---

## ğŸ§ª æµ‹è¯•

### å¿«é€Ÿæµ‹è¯•
```bash
# 1. æµ‹è¯•Parse-Video
curl http://localhost:18085/

# 2. æµ‹è¯•è§£æåŠŸèƒ½
curl "http://localhost:18085/video/share/url/parse?url=https://v.kuaishou.com/xxx"

# 3. å‘é€è§†é¢‘é“¾æ¥åˆ°Bot
# ç›´æ¥åœ¨Telegramä¸­å‘é€: https://v.kuaishou.com/KNXxJe25
```

### å®Œæ•´æµ‹è¯•æ¸…å•
å‚è§ [TEST_CHECKLIST.md](TEST_CHECKLIST.md)

---

## ğŸ“ æ”¯æŒ

### é‡åˆ°é—®é¢˜ï¼Ÿ

1. **æŸ¥çœ‹æ•…éšœæ’é™¤** - [TROUBLESHOOTING.md](TROUBLESHOOTING.md)
2. **æŸ¥çœ‹æ—¥å¿—**
   ```bash
   docker logs mirror-leech-telegram-bot-app-1 2>&1 | grep -E "ERROR|Exception"
   ```
3. **éªŒè¯éƒ¨ç½²**
   ```bash
   # æ£€æŸ¥æ‰€æœ‰æœåŠ¡
   docker ps | grep -E "parse-video|mirror-leech"
   
   # éªŒè¯æ–‡ä»¶
   docker exec mirror-leech-telegram-bot-app-1 \
     ls -la /usr/src/app/bot/modules/video_parser.py
   ```

### å¸¸è§é”™è¯¯é€ŸæŸ¥

| é”™è¯¯ | æ–‡æ¡£ä½ç½® |
|------|---------|
| `'NoneType' object has no attribute 'startswith'` | TROUBLESHOOTING.md #é”™è¯¯1 |
| ä¸‹è½½å®Œæˆä½†ä¸ä¸Šä¼  | TROUBLESHOOTING.md #é”™è¯¯2 |
| Dockerç¼“å­˜é—®é¢˜ | TROUBLESHOOTING.md #é”™è¯¯5 |
| æƒé™é—®é¢˜ | TROUBLESHOOTING.md #é”™è¯¯6 |

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
/root/data/
â”œâ”€â”€ test/                          # æµ‹è¯•å’Œæ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ README.md                  # æœ¬æ–‡ä»¶
â”‚   â”œâ”€â”€ QUICK_REFERENCE.md         # å¿«é€Ÿå‚è€ƒ
â”‚   â”œâ”€â”€ INTEGRATION_GUIDE.md       # éƒ¨ç½²æŒ‡å—
â”‚   â”œâ”€â”€ TROUBLESHOOTING.md         # æ•…éšœæ’é™¤
â”‚   â”œâ”€â”€ PARSE_VIDEO_INTEGRATION_SUMMARY.md  # æŠ€æœ¯æ€»ç»“
â”‚   â”œâ”€â”€ TEST_CHECKLIST.md          # æµ‹è¯•æ¸…å•
â”‚   â”œâ”€â”€ test_parse_video_api.py    # APIæµ‹è¯•
â”‚   â”œâ”€â”€ test_parse_video_helper.py # æ¨¡å—æµ‹è¯•
â”‚   â””â”€â”€ test_video_parser_logic.py # é€»è¾‘æµ‹è¯•
â”‚
â”œâ”€â”€ test/parse-video/              # Parse-Videoæºç 
â”‚   â”œâ”€â”€ main.go
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ ...
â”‚
â””â”€â”€ docker_data/mirror-leech-telegram-bot/  # Botç›®å½•
    â”œâ”€â”€ bot/
    â”‚   â”œâ”€â”€ helper/
    â”‚   â”‚   â”œâ”€â”€ parse_video_helper.py      âœ… æ–°å»º
    â”‚   â”‚   â””â”€â”€ ext_utils/
    â”‚   â”‚       â””â”€â”€ url_utils.py           âœ… æ–°å»º
    â”‚   â”œâ”€â”€ modules/
    â”‚   â”‚   â”œâ”€â”€ video_parser.py            âœ… æ–°å»ºï¼ˆ405è¡Œï¼‰
    â”‚   â”‚   â””â”€â”€ direct_link_handler.py     âœ… æ–°å»º
    â”‚   â””â”€â”€ core/
    â”‚       â””â”€â”€ handlers.py                âœ… ä¿®æ”¹
    â”œâ”€â”€ config.py                          âœ… ä¿®æ”¹
    â””â”€â”€ docker-compose.yml
```

---

## ğŸ”„ æ›´æ–°æ—¥å¿—

### v1.0 (2025-10-14)
- âœ… åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ… å¿«æ‰‹è§†é¢‘ä¸‹è½½æµ‹è¯•é€šè¿‡
- âœ… å®Œæ•´æ–‡æ¡£é›†
- âœ… å·²çŸ¥é—®é¢˜å…¨éƒ¨ä¿®å¤

---

## ğŸ‰ è‡´è°¢

- **Parse-Videoé¡¹ç›®** - æä¾›å¼ºå¤§çš„è§†é¢‘è§£ææœåŠ¡
- **Mirror-Leech-Telegram-Bot** - ä¼˜ç§€çš„Botæ¡†æ¶
- **yt-dlp** - å¯é çš„è§†é¢‘ä¸‹è½½å·¥å…·

---

## ğŸ“„ è®¸å¯è¯

æœ¬é›†æˆé¡¹ç›®éµå¾ªåŸé¡¹ç›®çš„è®¸å¯è¯ï¼š
- Parse-Video: MIT License
- Mirror-Leech-Telegram-Bot: GPL-3.0 License

---

**é¡¹ç›®çŠ¶æ€:** ğŸŸ¢ ç”Ÿäº§å°±ç»ª  
**æœ€åæ›´æ–°:** 2025-10-14  
**ç‰ˆæœ¬:** 1.0  
**æµ‹è¯•çŠ¶æ€:** âœ… å·²éªŒè¯é€šè¿‡


